<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <!--<a class="navbar-brand" [routerLink]="['']" routerLinkActive="active">Vici</a>-->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="navbar-collapse collapse w-100" id="navbarSupportedContent">
        <ul class="navbar-nav w-100">

            <li class="nav-item">
                <div ngbDropdown class="d-inline-block">
                    <button class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle>
                        {{currentSystemName}}
                    </button>
                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                        <a *ngFor="let system of systemReferences" class="dropdown-item"
                           [routerLink]="['', system.id, constants.views.aggregation, constants.params.undefined]">
                            {{ system.name }}
                        </a>
                        <div class="dropdown-divider"></div>
                        <!--<a routerLink="/details" class="dropdown-item">Action - 1</a>-->
                        <a class="dropdown-item" data-toggle="modal" data-target="#newSystemModal">New event repository
                            <span octicon="plus"></span></a>
                    </div>
                </div>
            </li>

        </ul>
        <ul class="navbar-nav w-100 justify-content-center">

            <li class="nav-item">
                <a [ngClass]="{'disabled': currentSystem === undefined, 'active': currentView === constants.views.aggregation}"
                   [routerLink]="['', currentSystem, constants.views.aggregation, currentDetailsTarget]"
                   class="nav-link"
                >Aggregation</a>
            </li>

            <li class="nav-item">
                <a [ngClass]="{'disabled': currentSystem === undefined || currentDetailsTarget === undefined, 'active': currentView === constants.views.details}"
                   [routerLink]="['', currentSystem, constants.views.details, currentDetailsTarget]"
                   class="nav-link">Details</a>
            </li>

            <li class="nav-item">
                <a [ngClass]="{'disabled': currentSystem === undefined || currentEventChainTarget === undefined, 'active': currentView === constants.views.eventChain}"
                   [routerLink]="['', currentSystem, constants.views.eventChain, currentEventChainTarget]"
                   class="nav-link">Event
                    chain</a>
            </li>
        </ul>
        <ul class="navbar-nav w-100 justify-content-end">

            <li class="nav-item dropdown ">
                <div class="btn-group">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarHistory" role="button" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false"
                       [ngClass]="{'disabled': history.length <= 0}">
                        History
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarHistory">
                        <a *ngFor="let unit of history"
                           class="dropdown-item"
                           [routerLink]="['', unit.systemId, unit.view, unit.target]">
                            {{ unit.msg }} - {{unit.date | timeAgo}}
                        </a>
                        <!--<a class="dropdown-item" href="#">Action</a>-->
                        <!--<a class="dropdown-item" href="#">Another action</a>-->
                        <!--<div class="dropdown-divider"></div>-->
                        <!--<a class="dropdown-item" href="#">Something else here</a>-->
                    </div>
                </div>
            </li>

            <li class="nav-item ">
                <a class="nav-link" href="#"><span octicon="question"></span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="modal" data-target="#settingsModal"><span
                        octicon="gear"></span></a>
            </li>
        </ul>
        <!--<form class="form-inline my-2 my-lg-0">-->
        <!--<input class="form-control mr-sm-2" type="search" placeholder="Event id" aria-label="Search">-->
        <!--<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>-->
        <!--</form>-->
    </div>
</nav>

<!-- New System Modal -->
<div class="modal fade" id="newSystemModal" tabindex="-1" role="dialog" aria-labelledby="newSystemModalLabel"
     aria-hidden="true">
    <div class="modal-dialog settings-modal" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newSystemModalLabel">Settings</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="container settings-container">
                    <div class="row">
                        <div class="col-12">
                            When changing a setting, all caches relative to that settings will be invalidated
                            automatically.

                            <div class="input-group settings-row">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Name</span>
                                </div>
                                <input type="text" class="form-control" placeholder="My eiffel event repository"
                                       [(ngModel)]="newSystemInput.name"/>
                            </div>

                            <div class="input-group settings-row">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">URL</span>
                                </div>

                                <input type="text" class="form-control" placeholder="URL"
                                       [(ngModel)]="newSystemInput.url"/>
                            </div>

                        </div>
                    </div>

                    <!--<div id="settings_content"></div>-->
                </div>
            </div>


            <div class="modal-footer">
                <button class="btn btn-success" type="button" (click)="newSystem()" data-dismiss="modal"><span
                        octicon="plus"></span>
                </button>
                <!--<button (click)="uploadCurrentRepositorySettings()"-->
                <!--[disabled]="!newSettings.has(currentSystem) || isUploadingRepository"-->
                <!--type="button" class="btn btn-primary">Save changes <span octicon="cloud-upload"></span>-->
                <!--</button>-->
            </div>
        </div>
    </div>
</div>

<div [hidden]="!isLoading" id="loader_overlay" class="overlay">
    <div id="loader" class="loader"></div>
</div>


<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel"
     aria-hidden="true">
    <div class="modal-dialog settings-modal" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="container settings-container">
                    <div class="row">
                        <div class="col-12">
                            When changing a setting, all caches relative to that settings will be invalidated
                            automatically.

                            <!--<div *ngFor="let system of systemReferences" id="eiffelEventPreferences[{{system.id}}]">-->
                            <div *ngFor="let system of systemReferences" [hidden]="system.id !== currentSystem">
                                <h3>{{system.name}}</h3>
                                <h4>General</h4>
                                <div class="input-group settings-row">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Time to keep caches (ms)</span>
                                    </div>
                                    <input type="number" class="form-control" placeholder="Positive integer"
                                           [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.cacheLifeTimeMs"
                                           (ngModelChange)="settingsInputChanged(system.id)"/>
                                </div>

                                <h4>Aggregation</h4>
                                <div *ngFor="let type of settings.types"
                                     class="input-group settings-row">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">{{type}}</span>
                                    </div>
                                    <input type="text" class="form-control" placeholder=""
                                           [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.aggregateOn[type]"
                                           (ngModelChange)="settingsInputChanged(system.id)"/>
                                </div>

                                <h4>Details</h4>

                                <h4>Event Chain</h4>
                                <div class="input-group settings-row">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Maximum jumps</span>
                                    </div>
                                    <input type="number" class="form-control" placeholder="Positive integer"
                                           [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.eventChainMaxSteps"
                                           (ngModelChange)="settingsInputChanged(system.id)"/>
                                </div>

                                <div class="input-group settings-row">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Maximum connections/node</span>
                                    </div>
                                    <input type="number" class="form-control" placeholder="Positive integer"
                                           [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.eventChainMaxConnections"
                                           (ngModelChange)="settingsInputChanged(system.id)"/>
                                </div>

                                <div class="input-group settings-row">
                                    <label class="checkbox-inline">
                                        <input type="checkbox"
                                               [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.eventChainGoUpStream"
                                               (ngModelChange)="settingsInputChanged(system.id)"/>
                                        Follow links <b>up</b> stream</label>
                                </div>
                                <div class="input-group settings-row">
                                    <label class="checkbox-inline">
                                        <input type="checkbox"
                                               [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.eventChainGoDownStream"
                                               (ngModelChange)="settingsInputChanged(system.id)"/>
                                        Follow links <b>down</b> stream</label>
                                </div>
                                <div class="input-group settings-row">
                                    <label class="checkbox-inline">
                                        <input type="checkbox"
                                               [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.eventChainTimeRelativeXAxis"
                                               (ngModelChange)="settingsInputChanged(system.id)"/>
                                        Node x-position defined by actual timestamp</label>
                                </div>

                                <h5>Live</h5>
                                <div class="input-group settings-row">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Number of base events (latest)</span>
                                    </div>
                                    <input type="number" class="form-control" placeholder="Positive integer"
                                           [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.streamBaseEvents"
                                           (ngModelChange)="settingsInputChanged(system.id)"/>
                                </div>
                                <div class="input-group settings-row">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Time between updates (ms)</span>
                                    </div>
                                    <input type="number" class="form-control" placeholder="Positive integer"
                                           [(ngModel)]="settings.eiffelEventRepositories[system.id].preferences.streamRefreshIntervalMs"
                                           (ngModelChange)="settingsInputChanged(system.id)"/>
                                </div>
                            </div>
                            <div [hidden]="currentSystem !== undefined">
                                Select a repository for more repository specific settings.
                            </div>
                        </div>

                        <!--<div id="settings_content"></div>-->
                    </div>
                </div>
            </div>


            <div class="modal-footer">
                <!--<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
                <button class="btn btn-warning" type="button" (click)="resetSettingsToServerDefault()">
                    Reset settings (server default) <span octicon="cloud-download"></span>
                </button>
                <button (click)="uploadCurrentRepositorySettings()"
                        [disabled]="!newSettings.has(currentSystem) || isUploadingRepository"
                        type="button" class="btn btn-primary">Save changes <span octicon="cloud-upload"></span>
                </button>
            </div>
        </div>
    </div>
</div>
<div id="aggregation-container" [hidden]="currentView !== constants.views.aggregation" class="content-container">
    <div id="aggregation_graph" class="content-container cy"></div>
</div>

<div id="details-container" [hidden]="currentView !== constants.views.details" class="content-container">
    <div id="details_table">
        <!--<table id="details_table_table" class="table table-striped table-bordered" cellspacing="0"-->
        <!--width="100%"></table>-->
    </div>
    <!--<div id="details_plot_container">-->
    <!--<div id="details_plot">-->

    <!--</div>-->
    <!--<div id="details_plot_legend" class="row justify-content-start legend-container">-->

    <!--</div>-->
    <!--</div>-->
</div>

<div id="eventchain-container" [hidden]="currentView !== constants.views.eventChain" class="content-container">
    <div id="eventchain_graph" class="content-container cy"></div>
</div>
